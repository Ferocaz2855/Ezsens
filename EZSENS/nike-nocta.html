<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIKE X NOCTA - EZSENS</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <div class="logo">
            <h1>EZSENS</h1>
        </div>
        <nav class="nav">
            <a href="index.html" class="nav-link">Inicio</a>
            <a href="nike-tech.html" class="nav-link">NIKE TECH</a>
            <a href="nike-zyna.html" class="nav-link">NIKE X ZYNA</a>
            <a href="nike-nocta.html" class="nav-link active">NIKE X NOCTA</a>
        </nav>
        <div class="cart-icon">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count">0</span>
        </div>
    </header>

    <section class="category-banner" style="background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('assets/images/productos/nike-x-nocta-banner.jpg') center/cover;">
        <div class="banner-content">
            <h1>NIKE X NOCTA</h1>
            <p>Colaboraci√≥n premium con Drake - Edici√≥n exclusiva</p>
        </div>
    </section>

    <section class="category-products">
        <div class="products-grid" id="nocta-products">
            <!-- Productos se cargan din√°micamente -->
        </div>
    </section>

    <!-- Shopping Cart Modal -->
    <div class="cart-modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>TU CARRITO</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="cart-items" id="cartItems">
                    <!-- Items del carrito -->
                </div>
                <div class="cart-total">
                    <p>Total: <span id="cartTotal">S/ 0.00</span></p>
                </div>
                <button class="checkout-btn" id="checkoutBtn">REALIZAR PEDIDO</button>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="checkout-modal" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>DATOS DEL PEDIDO</h3>
                <button class="close-checkout">&times;</button>
            </div>
            <form id="checkoutForm" class="checkout-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="nombre">Nombres *</label>
                        <input type="text" id="nombre" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="apellido">Apellidos *</label>
                        <input type="text" id="apellido" name="apellido" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="whatsapp">WhatsApp *</label>
                        <input type="tel" id="whatsapp" name="whatsapp" required placeholder="+51 999 888 777">
                    </div>
                    <div class="form-group">
                        <label for="dni">DNI o CE *</label>
                        <input type="text" id="dni" name="dni" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="provincia">Departamento/Provincia *</label>
                        <div class="search-select">
                            <input type="text" id="provinciaSearch" placeholder="Buscar departamento..." 
                                   class="search-input" onkeyup="filtrarProvincias()">
                            <select id="provincia" name="provincia" required class="select-hidden">
                                <option value="">Selecciona departamento</option>
                                <!-- Provincias se cargan din√°micamente -->
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="distrito">Distrito *</label>
                        <div class="search-select">
                            <input type="text" id="distritoSearch" placeholder="Buscar distrito..." 
                                   class="search-input" disabled onkeyup="filtrarDistritos()">
                            <select id="distrito" name="distrito" required class="select-hidden" disabled>
                                <option value="">Primero selecciona departamento</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="direccion">Direcci√≥n completa *</label>
                    <textarea id="direccion" name="direccion" rows="3" required placeholder="Calle, n√∫mero, urbanizaci√≥n, referencia"></textarea>
                </div>

                <div class="form-group">
                    <label for="referencia">Referencia adicional (opcional)</label>
                    <textarea id="referencia" name="referencia" rows="2" placeholder="Punto de referencia cercano, color de casa, etc."></textarea>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="aceptoTerminos" required>
                        Acepto los t√©rminos y condiciones *
                    </label>
                </div>

                <div class="form-actions">
                    <button type="submit" class="submit-order">CONFIRMAR PEDIDO</button>
                </div>
            </form>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>EZSENS</h4>
                <p>Tienda oficial de ropa deportiva premium</p>
            </div>
            <div class="footer-section">
                <h4>Contacto</h4>
                <p><i class="fab fa-whatsapp"></i> +51 999 888 777</p>
                <p><i class="fas fa-envelope"></i> info@ezsens.com</p>
            </div>
            <div class="footer-section">
                <h4>M√©todos de pago</h4>
                <p>Yape / Plin / Transferencia</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 EZSENS. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Productos Nike x Nocta
        const productosNocta = [
            {
                id: 301,
                nombre: "Nike x Nocta Tech Fleece Hoodie",
                imagen: "assets/images/productos/nike-x-nocta-1.jpg",
                bonos: "+200 bonbons",
                precio: 2200.00, // En soles
                sku: "NOCTA-001",
                descripcion: "Chamarra premium Nike x Nocta Tech Fleece"
            },
            {
                id: 302,
                nombre: "Nike x Nocta Track Pants",
                imagen: "assets/images/productos/nike-x-nocta-2.jpg",
                bonos: "+180 bonbons",
                precio: 1950.00,
                sku: "NOCTA-002",
                descripcion: "Pantalones Nike x Nocta edici√≥n especial"
            },
            {
                id: 303,
                nombre: "Nike x Nocta Gloves",
                imagen: "assets/images/productos/nike-x-nocta-3.jpg",
                bonos: "+100 bonbons",
                precio: 850.00,
                sku: "NOCTA-003",
                descripcion: "Guantes Nike x Nocta colecci√≥n invierno"
            },
            {
                id: 304,
                nombre: "Nike x Nocta Full Set",
                imagen: "assets/images/productos/nike-x-nocta-4.jpg",
                bonos: "+350 bonbons",
                precio: 3800.00,
                sku: "NOCTA-004",
                descripcion: "Set completo Nike x Nocta (Chamarra + Pantal√≥n)"
            }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            cargarProductosNocta();
            configurarEventos();
            cargarDepartamentos();
        });

        function cargarProductosNocta() {
            const container = document.getElementById('nocta-products');
            container.innerHTML = '';
            
            productosNocta.forEach(producto => {
                const productCard = `
                    <div class="product-card">
                        <div class="product-image" style="background-image: url('${producto.imagen}')"></div>
                        <div class="product-info">
                            <h3 class="product-title">${producto.nombre}</h3>
                            <p class="product-bonus">${producto.bonos}</p>
                            <p class="product-price">S/ ${producto.precio.toFixed(2)}</p>
                            <p class="product-sku">SKU: ${producto.sku}</p>
                            <p class="product-desc">${producto.descripcion}</p>
                            <button class="add-to-cart" onclick="agregarAlCarrito(${producto.id})">
                                AGREGAR AL CARRITO
                            </button>
                        </div>
                    </div>
                `;
                container.innerHTML += productCard;
            });
        }

        async function cargarDepartamentos() {
            try {
                const response = await fetch('assets/data/peru.json');
                const data = await response.json();
                const selectProvincia = document.getElementById('provincia');
                
                // Llenar select de provincias
                data.departamentos.forEach(depto => {
                    const option = document.createElement('option');
                    option.value = depto.nombre;
                    option.textContent = depto.nombre;
                    selectProvincia.appendChild(option);
                });
                
                // Configurar evento para cargar distritos
                selectProvincia.addEventListener('change', function() {
                    const selectedDepto = data.departamentos.find(d => d.nombre === this.value);
                    const distritoSearch = document.getElementById('distritoSearch');
                    const distritoSelect = document.getElementById('distrito');
                    
                    if (selectedDepto) {
                        // Habilitar b√∫squeda de distritos
                        distritoSearch.disabled = false;
                        distritoSearch.placeholder = `Buscar distrito en ${selectedDepto.nombre}...`;
                        
                        // Limpiar y llenar select de distritos
                        distritoSelect.innerHTML = '<option value="">Selecciona distrito</option>';
                        selectedDepto.distritos.forEach(distrito => {
                            const option = document.createElement('option');
                            option.value = distrito;
                            option.textContent = distrito;
                            distritoSelect.appendChild(option);
                        });
                        
                        distritoSelect.disabled = false;
                    }
                });
                
            } catch (error) {
                console.error('Error cargando departamentos:', error);
            }
        }

        function configurarEventos() {
            // Carrito
            document.querySelector('.cart-icon').addEventListener('click', mostrarCarrito);
            document.querySelector('.close-modal').addEventListener('click', cerrarCarrito);
            document.getElementById('checkoutBtn').addEventListener('click', mostrarCheckout);
            document.querySelector('.close-checkout').addEventListener('click', cerrarCheckout);
            
            // Checkout
            document.getElementById('checkoutForm').addEventListener('submit', procesarPedido);
            
            // Cerrar modales al hacer clic fuera
            window.addEventListener('click', (e) => {
                if (e.target === document.getElementById('cartModal')) cerrarCarrito();
                if (e.target === document.getElementById('checkoutModal')) cerrarCheckout();
            });
            
            // Configurar b√∫squeda en select de provincia
            const provinciaSearch = document.getElementById('provinciaSearch');
            const provinciaSelect = document.getElementById('provincia');
            
            provinciaSearch.addEventListener('click', function() {
                provinciaSelect.size = 5; // Mostrar como lista
                provinciaSelect.style.display = 'block';
            });
            
            provinciaSelect.addEventListener('change', function() {
                provinciaSearch.value = this.options[this.selectedIndex].text;
                provinciaSelect.size = 1;
                provinciaSelect.style.display = 'none';
            });
            
            // Configurar b√∫squeda en select de distrito
            const distritoSearch = document.getElementById('distritoSearch');
            const distritoSelect = document.getElementById('distrito');
            
            distritoSearch.addEventListener('click', function() {
                if (!this.disabled) {
                    distritoSelect.size = 5;
                    distritoSelect.style.display = 'block';
                }
            });
            
            distritoSelect.addEventListener('change', function() {
                distritoSearch.value = this.options[this.selectedIndex].text;
                distritoSelect.size = 1;
                distritoSelect.style.display = 'none';
            });
        }

        // Funciones del carrito
        function agregarAlCarrito(id) {
            const producto = productosNocta.find(p => p.id === id);
            if (!producto) return;
            
            let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            const itemExistente = carrito.find(item => item.id === id);
            
            if (itemExistente) {
                itemExistente.cantidad++;
            } else {
                carrito.push({
                    ...producto,
                    cantidad: 1
                });
            }
            
            localStorage.setItem('carrito', JSON.stringify(carrito));
            actualizarCarrito();
            mostrarNotificacion(`${producto.nombre} agregado al carrito`, 'success');
        }

        function actualizarCarrito() {
            const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            const totalItems = carrito.reduce((total, item) => total + item.cantidad, 0);
            document.querySelector('.cart-count').textContent = totalItems;
        }

        function mostrarCarrito() {
            const modal = document.getElementById('cartModal');
            const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            const itemsContainer = document.getElementById('cartItems');
            const totalContainer = document.getElementById('cartTotal');
            
            if (carrito.length === 0) {
                itemsContainer.innerHTML = '<p class="cart-empty">El carrito est√° vac√≠o</p>';
                totalContainer.textContent = 'S/ 0.00';
            } else {
                let html = '';
                let total = 0;
                
                carrito.forEach(item => {
                    const subtotal = item.precio * item.cantidad;
                    total += subtotal;
                    
                    html += `
                        <div class="cart-item">
                            <div class="cart-item-info">
                                <h4>${item.nombre}</h4>
                                <p>S/ ${item.precio.toFixed(2)} x ${item.cantidad}</p>
                            </div>
                            <div class="cart-item-actions">
                                <p class="cart-item-subtotal">S/ ${subtotal.toFixed(2)}</p>
                                <button onclick="eliminarDelCarrito(${item.id})" class="btn-delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                itemsContainer.innerHTML = html;
                totalContainer.textContent = `S/ ${total.toFixed(2)}`;
            }
            
            modal.style.display = 'flex';
        }

        function cerrarCarrito() {
            document.getElementById('cartModal').style.display = 'none';
        }

        function eliminarDelCarrito(id) {
            let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            carrito = carrito.filter(item => item.id !== id);
            localStorage.setItem('carrito', JSON.stringify(carrito));
            mostrarCarrito();
            actualizarCarrito();
        }

        function mostrarCheckout() {
            const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            if (carrito.length === 0) {
                mostrarNotificacion('El carrito est√° vac√≠o', 'error');
                return;
            }
            
            cerrarCarrito();
            document.getElementById('checkoutModal').style.display = 'flex';
        }

        function cerrarCheckout() {
            document.getElementById('checkoutModal').style.display = 'none';
        }

        // Funciones de b√∫squeda
        window.filtrarProvincias = function() {
            const input = document.getElementById('provinciaSearch');
            const filter = input.value.toUpperCase();
            const select = document.getElementById('provincia');
            const options = select.getElementsByTagName('option');
            
            for (let i = 0; i < options.length; i++) {
                const txtValue = options[i].textContent || options[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    options[i].style.display = "";
                } else {
                    options[i].style.display = "none";
                }
            }
        }

        window.filtrarDistritos = function() {
            const input = document.getElementById('distritoSearch');
            const filter = input.value.toUpperCase();
            const select = document.getElementById('distrito');
            const options = select.getElementsByTagName('option');
            
            for (let i = 0; i < options.length; i++) {
                const txtValue = options[i].textContent || options[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    options[i].style.display = "";
                } else {
                    options[i].style.display = "none";
                }
            }
        }

        // Funci√≥n para mostrar notificaciones
        function mostrarNotificacion(mensaje, tipo = 'success') {
            const notificacion = document.createElement('div');
            notificacion.className = `notificacion ${tipo}`;
            notificacion.innerHTML = `
                <i class="fas ${tipo === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${mensaje}</span>
            `;
            
            document.body.appendChild(notificacion);
            
            setTimeout(() => notificacion.classList.add('show'), 10);
            
            setTimeout(() => {
                notificacion.classList.remove('show');
                setTimeout(() => notificacion.remove(), 300);
            }, 3000);
        }

        // Funci√≥n para procesar pedido
        async function procesarPedido(e) {
            e.preventDefault();
            
            // Validar t√©rminos
            if (!document.getElementById('aceptoTerminos').checked) {
                mostrarNotificacion('Debes aceptar los t√©rminos y condiciones', 'error');
                return;
            }
            
            const formData = new FormData(document.getElementById('checkoutForm'));
            const datosCliente = Object.fromEntries(formData);
            const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            
            if (carrito.length === 0) {
                mostrarNotificacion('El carrito est√° vac√≠o', 'error');
                return;
            }
            
            const total = carrito.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            const pedidoId = 'NOCTA-' + Date.now().toString().slice(-6);
            
            // Crear mensaje para WhatsApp
            let mensaje = `ü¶â *NUEVO PEDIDO NIKE X NOCTA* ü¶â\n\n`;
            mensaje += `*Pedido ID:* ${pedidoId}\n`;
            mensaje += `*Fecha:* ${new Date().toLocaleString('es-PE')}\n\n`;
            
            mensaje += `*üë§ DATOS DEL CLIENTE*\n`;
            mensaje += `Nombre: ${datosCliente.nombre} ${datosCliente.apellido}\n`;
            mensaje += `WhatsApp: ${datosCliente.whatsapp}\n`;
            mensaje += `DNI/CE: ${datosCliente.dni}\n`;
            mensaje += `Ubicaci√≥n: ${datosCliente.provincia}, ${datosCliente.distrito}\n`;
            mensaje += `Direcci√≥n: ${datosCliente.direccion}\n`;
            if (datosCliente.referencia) {
                mensaje += `Referencia: ${datosCliente.referencia}\n`;
            }
            
            mensaje += `\n*üõçÔ∏è PRODUCTOS (NIKE X NOCTA)*\n`;
            carrito.forEach((item, index) => {
                const subtotal = item.precio * item.cantidad;
                mensaje += `${index + 1}. ${item.nombre}\n`;
                mensaje += `   Cantidad: ${item.cantidad}\n`;
                mensaje += `   Precio: S/ ${item.precio.toFixed(2)}\n`;
                mensaje += `   Subtotal: S/ ${subtotal.toFixed(2)}\n\n`;
            });
            
            mensaje += `*üí∞ TOTAL A PAGAR: S/ ${total.toFixed(2)}*\n\n`;
            mensaje += `*üìã ESTADO:* Pendiente de pago\n`;
            mensaje += `*üí≥ M√âTODO:* Yape/Plin/Transferencia`;
            
            // N√∫mero de WhatsApp (cambiar por tu n√∫mero)
            const telefono = '51999888777'; // TU N√öMERO AQU√ç
            const mensajeCodificado = encodeURIComponent(mensaje);
            const whatsappURL = `https://wa.me/${telefono}?text=${mensajeCodificado}`;
            
            // Guardar pedido en localStorage
            const pedido = {
                id: pedidoId,
                fecha: new Date().toISOString(),
                productos: carrito,
                total: total,
                cliente: datosCliente,
                categoria: 'nike-nocta'
            };
            
            let pedidos = JSON.parse(localStorage.getItem('pedidos_ezsens')) || [];
            pedidos.push(pedido);
            localStorage.setItem('pedidos_ezsens', JSON.stringify(pedidos));
            
            // Limpiar carrito
            localStorage.removeItem('carrito');
            actualizarCarrito();
            
            // Mostrar confirmaci√≥n y abrir WhatsApp
            mostrarNotificacion('¬°Pedido confirmado! Redirigiendo a WhatsApp...', 'success');
            
            setTimeout(() => {
                window.open(whatsappURL, '_blank');
                cerrarCheckout();
                document.getElementById('checkoutForm').reset();
            }, 1500);
        }
    </script>
</body>
</html>